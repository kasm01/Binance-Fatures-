# ğŸ“Œ Gerekli KÃ¼tÃ¼phaneleri YÃ¼kleme
import numpy as np
import ta
import logging
import pandas as pd
from binance.client import Client
from binance.enums import ORDER_TYPE_MARKET, SIDE_BUY, SIDE_SELL

# ğŸ“Œ Binance API AnahtarlarÄ±
API_KEY = "YOUR_BINANCE_API_KEY"
API_SECRET = "YOUR_BINANCE_API_SECRET"
client = Client(API_KEY, API_SECRET, testnet=True)

# ğŸ“Œ Piyasa Verilerini Ã‡ekme
def get_market_data(symbol):
    try:
        klines = client.get_klines(symbol=symbol, interval=Client.KLINE_INTERVAL_1HOUR, limit=50)
        df = pd.DataFrame(klines, columns=['timestamp', 'open', 'high', 'low', 'close', 'volume'])
        df['close'] = df['close'].astype(float)
        df['volume'] = df['volume'].astype(float)
        return df
    except Exception as e:
        logging.error(f"âš ï¸ API isteÄŸi baÅŸarÄ±sÄ±z: {e}")
        return None

# ğŸ“Œ AI Destekli Scalping Stratejisi
def scalping_strategy(symbol):
    df = get_market_data(symbol)
    if df is None:
        return None

    # ğŸ“Œ Teknik gÃ¶stergeler
    df['rsi'] = ta.momentum.RSIIndicator(df['close']).rsi()
    df['macd'] = ta.trend.MACD(df['close']).macd()
    df['bollinger_upper'] = ta.volatility.BollingerBands(df['close']).bollinger_hband()
    df['bollinger_lower'] = ta.volatility.BollingerBands(df['close']).bollinger_lband()

    # ğŸ“Œ AI Modeli ile En Ä°yi GiriÅŸ NoktasÄ±
    if df['rsi'].iloc[-1] < 30 and df['close'].iloc[-1] < df['bollinger_lower'].iloc[-1]:
        return "BUY"
    elif df['rsi'].iloc[-1] > 70 and df['close'].iloc[-1] > df['bollinger_upper'].iloc[-1]:
        return "SELL"
    else:
        return None

# ğŸ“Œ AI Destekli Swing Trade Stratejisi
def swing_trade_strategy(symbol):
    df = get_market_data(symbol)
    if df is None:
        return None

    # ğŸ“Œ Teknik gÃ¶stergeler
    df['ema_50'] = ta.trend.EMAIndicator(df['close'], window=50).ema_indicator()
    df['ema_200'] = ta.trend.EMAIndicator(df['close'], window=200).ema_indicator()
    df['macd'] = ta.trend.MACD(df['close']).macd()
    df['adx'] = ta.trend.ADXIndicator(df['high'], df['low'], df['close']).adx()

    # ğŸ“Œ AI Destekli GiriÅŸ Stratejisi
    if df['ema_50'].iloc[-1] > df['ema_200'].iloc[-1] and df['macd'].iloc[-1] > 0 and df['adx'].iloc[-1] > 25:
        return "BUY"
    elif df['ema_50'].iloc[-1] < df['ema_200'].iloc[-1] and df['macd'].iloc[-1] < 0 and df['adx'].iloc[-1] > 25:
        return "SELL"
    else:
        return None

# ğŸ“Œ AI Destekli Dinamik KaldÄ±raÃ§ YÃ¶netimi
def get_dynamic_leverage(symbol):
    df = get_market_data(symbol)
    if df is None:
        return 5  # VarsayÄ±lan kaldÄ±raÃ§

    df['atr'] = ta.volatility.AverageTrueRange(df['high'], df['low'], df['close'], window=14).average_true_range()
    volatility = df['atr'].iloc[-1] / df['close'].iloc[-1]

    if volatility > 0.05:
        leverage = 2  # YÃ¼ksek volatilite â†’ DÃ¼ÅŸÃ¼k kaldÄ±raÃ§
    elif volatility > 0.02:
        leverage = 5  # Orta volatilite â†’ Orta kaldÄ±raÃ§
    else:
        leverage = 10  # DÃ¼ÅŸÃ¼k volatilite â†’ YÃ¼ksek kaldÄ±raÃ§

    return leverage

# ğŸ“Œ AI Destekli Ä°ÅŸlem AÃ§ma
def place_order(symbol, strategy):
    entry_price = float(client.get_symbol_ticker(symbol=symbol)['price'])
    action = strategy(symbol)
    
    if action is None:
        logging.info(f"ğŸš« {symbol} iÃ§in uygun iÅŸlem sinyali bulunamadÄ±.")
        return

    leverage = get_dynamic_leverage(symbol)
    client.futures_change_leverage(symbol=symbol, leverage=leverage)
    
    quantity = 0.01  # Ã–rnek iÅŸlem miktarÄ±
    order = client.futures_create_order(
        symbol=symbol,
        side=action,
        type=ORDER_TYPE_MARKET,
        quantity=quantity
    )

    logging.info(f"âœ… {symbol} iÃ§in {action} iÅŸlemi aÃ§Ä±ldÄ±. Miktar: {quantity}, GiriÅŸ FiyatÄ±: {entry_price}")

# ğŸ“Œ Scalping ve Swing Trade Stratejileri ile Ä°ÅŸlem AÃ§ma
symbols = ["BTCUSDT", "ETHUSDT"]
for symbol in symbols:
    place_order(symbol, scalping_strategy)
    place_order(symbol, swing_trade_strategy)
